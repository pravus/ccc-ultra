#!/bin/bash

/usr/bin/docker stop ccc-ultra
/usr/bin/docker rm ccc-ultra
exec /usr/bin/docker run "$@" \
  --rm \
  --name ccc-ultra \
  --hostname www.carbon.cc \
  --network www \
  --publish 80:8080 \
  --publish 443:8443 \
  --publish 10.36.0.1:8448:8448 \
  --env-file /opt/ccc/etc/ultra/env \
  --volume /opt/ccc/srv/www:/www:ro \
  --volume /opt/ccc/etc/ssl/carbon.cc/fullchain.pem:/tls/cert:ro \
  --volume /opt/ccc/etc/ssl/carbon.cc/privkey.pem:/tls/key:ro \
  ccc-ultra:latest \
    -ctrl=:8448 \
    -http=:8080 \
    -https=:8443 \
    -https-tls-cert=/tls/cert \
    -https-tls-key=/tls/key \
    -reverse-proxy /g=http://ccc-grafana:3000 \
    -reverse-proxy /yt=http://ccc-youtrack:8080 \
    -root=/www/index.html \
    -favicon-ico=/www/favicon.ico \
    -prometheus
